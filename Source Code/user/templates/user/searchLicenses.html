{% extends "user/base.html" %}
{% load static %}
{% load pollExtras %}

{% block optional %}
    <!-- Load CSS file for DataTables  -->
    <link
      rel="stylesheet"
      href="{%static "license_management_system/pages/css/dataTables.css" %}"
    />

    <!-- load DataTables  -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"
      integrity="sha512-BkpSL20WETFylMrcirBahHfSnY++H2O1W+UnEEO4yNIl+jI2+zowyoGJpbtk6bx97fBXf++WJHSSK2MV4ghPcg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
{% endblock %}

{% block contents %}
    <!-- Striped Rows -->

    <!-- Success Messages -->
    {% for msg in messages %}
    <div class="alert alert-success alert-dismissible" role="alert">
    {{msg}}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    <!-- Success Messages -->

    {% if "Admin" in request.session.role %}
    <div class="row gy-3">
        <div class="col-sm-4">
            <small class="text-light fw-semibold">Label</small>
            <div class="demo-inline-spacing">
                <a href="{% url "user:upload" %}">
                    <button type="button" class="btn btn-outline-primary">
                        All License
                        <span class="badge bg-white text-primary"><i class='bx bxs-file-plus'></i></span>
                    </button>
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="card-body">
        <div class="table-responsive text-nowrap">
            <table class="table table-sm" id="LicensesView">
                <thead >
                    <tr>
                    <th>Title</th>
                    <th>Name</th>
                    <th>Identifier</th>
                    <th>Namespace</th>
                    <th>Date Created</th>
                    <th>Last Modified</th>
                    <th>Status</th>
                    <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for license in licenses %}     
                        <tr>
                        <td><i class="fab fa-angular fa-lg text-danger me-3"></i>{{ license.title }}</td>
                        <td>{{ license.name }}</td>
                        <td>
                            {{ license.identifier }}
                        </td>
                        <td>
                            {{ license.namespace }}
                        </td>
                        <td>
                            {{ license.id|dateVal:"first" }}
                        </td>
                        <td>
                            {{ license.id|dateVal:"lastModified" }}
                        </td>
                        {% if license.status|lower == "draft" %}
                        <td><span class="badge bg-label-warning me-1">{{ license.status }}</span></td>
                        <td>
                            <div class="dropdown">
                                <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                <i class="bx bx-dots-vertical-rounded"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="{% url "user:licenseDetails" license.id %}"
                                    ><i class="bx bx-receipt me-1"></i> View </a>
                                <a class="dropdown-item" href="{% url "user:LicenseTracking" license.id %}"
                                    ><i class="bx bx-directions me-1"></i> Check Tracking </a>
                                {% if "Uploader" or "Admin" in request.session.role %}
                                    <a class="dropdown-item" href="{% url "user:licenseEdit" license.id %}"
                                    ><i class="bx bx-file me-1"></i> Edit</a
                                    >
                                {% endif %}
                                </div>
                            </div>
                        </td>
                        {% elif license.status|lower == "approved" %}
                            <td><span class="badge bg-label-success me-1">{{ license.status }}</span></td>
                            <td>
                                <div class="dropdown">
                                    <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                    <i class="bx bx-dots-vertical-rounded"></i>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="{% url "user:licenseDetails" license.id %}"
                                        ><i class="bx bx-receipt me-1"></i> View </a>
                                    <a class="dropdown-item" href="{% url "user:LicenseTracking" license.id %}"
                                        ><i class="bx bx-directions me-1"></i> Check Tracking </a>
                                    {% if "Admin" in request.session.role %}
                                        <a class="dropdown-item" href="{% url "user:licenseEdit" license.id %}"
                                        ><i class="bx bx-file me-1"></i> Edit</a
                                        >
                                    {% endif %}
                                    </div>
                                </div>
                            </td>
                        {% else %}
                            <td><span class="badge bg-label-danger me-1">{{ license.status }}</span></td>
                            <td>
                                <div class="dropdown">
                                    <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                    <i class="bx bx-dots-vertical-rounded"></i>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="{% url "user:licenseDetails" license.id %}"
                                        ><i class="bx bx-receipt me-1"></i> View </a>
                                    <a class="dropdown-item" href="{% url "user:LicenseTracking" license.id %}"
                                        ><i class="bx bx-directions me-1"></i> Check Tracking </a>
                                    {% if "Uploader" or "Admin" in request.session.role %}
                                        <a class="dropdown-item" href="{% url "user:licenseEdit" license.id %}"
                                        ><i class="bx bx-file me-1"></i> Edit</a
                                        >
                                    {% endif %}
                                    </div>
                                </div>
                            </td>
                        {% endif %}
                        
                        </tr>  
                    {% endfor %}          
                </tbody>
                </table> 
            </div>     
            <script>
                $(document).ready( function () {
                    $('#LicensesView').DataTable();
                } );
            </script>   
        <!--/ Striped Rows -->

        <!--Export-->
        {% if "Publisher" in request.session.role %}
            <div class="demo-inline-spacing">
                <div class="btn-group">
                <button type="button" class="btn btn-primary">Export</button>
                <button
                    type="button"
                    class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                >
                    <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{% url "user:export" "csv"%}">CSV</a></li>
                    <li><a class="dropdown-item" href="{% url "user:export" "json"%}">Json</a></li>
                    <li><a class="dropdown-item" href="{% url "user:export" "xls"%}">Xls</a></li>
                </ul>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary">Zip and Export</button>
                    <button
                        type="button"
                        class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                    >
                        <span class="visually-hidden">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url "user:zipAndexport" "csv"%}">CSV</a></li>
                        <li><a class="dropdown-item" href="{% url "user:zipAndexport" "json"%}">Json</a></li>
                        <li><a class="dropdown-item" href="{% url "user:zipAndexport" "xls"%}">Xls</a></li>
                    </ul>
                    </div>

            </div>
        {% endif %}
        <!--/ Export-->
    </div>

{% endblock %}